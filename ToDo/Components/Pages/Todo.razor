@using MongoDB.Bson;

@using ToDo.Models;
@using ToDo.Services;
@inject TodoService TodoService
@page "/"
@rendermode InteractiveServer

<h3>Todo</h3>

<EditForm Model="@newTodo" OnValidSubmit="HandleValidSubmit" FormName="AddTodo">


    <div class="form-group">
        <label for="todo">What you need to do?</label>
        <InputText id="todotext" class="form-control" autocomplete="off" @bind-Value="newTodo.TodoText"  required />
    </div>
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <button type="submit" class="btn btn-primary mt-3">Add</button>
    </div>
</EditForm>

<button type="button" class="btn btn-danger mb-1" @onclick="() => DeleteAll()">Clear List</button>

@foreach(var todolist in TodoList)
    {
<ul>
    <li class=@CheckForToggle(todolist) @onclick="()=>ToggleItem(todolist)" >@todolist.TodoText</li>

</ul>
}


@code {
    private List<TodoModel> TodoList = new List<TodoModel> { };
    private TodoModel newTodo = new TodoModel();

    protected override async Task OnInitializedAsync()
    {
        TodoList = await TodoService.GetTodoListAsync();


    }
    public async Task RefreshUI()
    {
        TodoList = await TodoService.GetTodoListAsync();
    }
    public async Task HandleValidSubmit()
    {

        await TodoService.AddItemAsync(newTodo);
        newTodo = new TodoModel();

        await RefreshUI();

    }



    private async Task DeleteItem(TodoModel todoItem)
    {
        await TodoService.RemoveItemAsync(todoItem);

        await RefreshUI();
    }

    private async Task DeleteAll()
    {



        await TodoService.DeleteAll();

        await RefreshUI();
    }



    private async Task ToggleItem(TodoModel todoItem)
    {
         todoItem.IsChecked = !todoItem.IsChecked;
    }

    private string CheckForToggle(TodoModel todoItem)
    {
        if (todoItem.IsChecked == true)
        {
            return "checked";
        }
        else
            return "";
    }


}
